<!DOCTYPE html>
<html>
    <head>
        <title>TŌGI - Image Boards</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link rel="stylesheet" href="Styles/post.css">
    </head>
    <body>
        <div class="header" id="myHeader">
            <h2>TŌGI</h2>
            <a href="index.html">
                <div class = "logo"></div>
            </a>
            <h2 class="threadName">Thread Name</h2>
            <button type="button" class="newComment" id="buttonReply">Reply</button>
            <form action="commentList" style="display:none" method="post" id="replyBox">
                Image URL: <input type="text" name="image" id="image">
                <fieldset>
                    <legend>Comment</legend>
                    <textarea rows="5" cols="50" name="comment" id="comment"
                              placeholder="Enter your comment here..."></textarea>
                </fieldset>
                <button onClick="javascript:window.location.href='post.html'" id="buttonPost">Post Comment</button>
            </form>
        </div>

        <table id="tdata">
            <td>
                <div class="content">
                    <div class="imgdiv"></div>
                    <div class="title">
                        sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment sample comment 
                    </div>
                </div>
            </td>
        </table>

        <script>
            window.onscroll = function () {
                stickyHeader();
            };

            var header = document.getElementById("myHeader");
            var sticky = header.offsetTop;

            function stickyHeader() {
                if (window.pageYOffset > sticky) {
                    header.classList.add("sticky");
                } else {
                    header.classList.remove("sticky");
                }
            }
            document.getElementById("buttonReply").onclick = function () {
                hideCommentBox();
            };
            function hideCommentBox() {
                var x = document.getElementById("replyBox");
                if (x.style.display === "none") {
                    x.style.display = "block";
                } else {
                    x.style.display = "none";
                }
            }
                    $('#buttonPost').click(function () {
                        var img = $("#image").val();
                        var comment = $('#comment').val();
                        $('#errorc').html('');
                        $('#error').html('');
                        if (img.length === 0 || comment.length === 0) {
                            if (img.length === 0) {
                                $('#errorc').html('Invalid Image URL');
                            }
                            if (comment.length === 0) {
                                $('#error').html('Invalid Comment');
                            }
                            return;
                        }
                        var data = JSON.stringify({
                            image: img,
                            comment: comment
                        });
                        $.ajax({
                            url: 'api/comments',
                            type: 'post',
                            data: data,
                            contentType: 'application/json',
                            dataType: 'text',
                            success: function (resp) {
                                $('#response').html('Your comment has been sent.');
                            },
                            error: function () {
                                alert('Network communication failed');
                            }
                        });
                        return false;
                    });
                </script>
        <script>
            $.ajax({
                url: 'postservlet',
                type: 'post',
                dataType: 'text',
                success: function (resp) {

                    const boards = $.trim(resp).split("\n");
                    const table = $("#tdata tbody");

                    for (var i = 0; i < boards.length; i++) {
                        table.append("<tr><td>" + menu[i].split("-")[0] +
                                "</td><td class='price'>$" + menu[i].split("-")[1] + "</td></tr>");
                    }
                },
                error: function () {
                    alert('Something has gone wrong');
                }
            });
            </script>
  
    </body>
</html>
